===================
Convert to Solr XML
===================



We need to set the site since we're a functional test:

>>> import zope.app.component.hooks
>>> old_site = zope.app.component.hooks.getSite()
>>> zope.app.component.hooks.setSite(getRootFolder())


Get article for adapter tests:

>>> import zeit.cms.interfaces
>>> article = zeit.cms.interfaces.ICMSContent(
...     'http://xml.zeit.de/online/2007/01/Somalia')


Build a converter:

>>> import zeit.solr.interfaces
>>> article_converter = zeit.solr.interfaces.ISolrConverter(article)
>>> article_converter
<zeit.solr.converter.SolrConverter object at 0xc5f02ac>


Convert an article and check resultset:

>>> import lxml.etree
>>> root_node = article_converter.prepare_dav_props()
>>> print lxml.etree.tostring(root_node, pretty_print=True)
<add xmlns:py="http://codespeak.net/lxml/objectify/pytype" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <doc>
    <field ...
    <field name="icon" py:pytype="str">/@@/zeit-content-article-interfaces-IArticle-zmi_icon.png</field>...
  </doc>
</add>
<BLANKLINE>


Convert an image and check resultset:
(TODO: Use image with dav properties!)

>>> image = zeit.cms.interfaces.ICMSContent(
... 'http://xml.zeit.de/2006/DSC00109_2.JPG')
>>> image_converter = zeit.solr.interfaces.ISolrConverter(image)
>>> root_node = image_converter.prepare_dav_props()
>>> print lxml.etree.tostring(root_node, pretty_print=True)
<add xmlns:py="http://codespeak.net/lxml/objectify/pytype" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <doc>
    <field ...
  </doc>
</add>
<BLANKLINE>


Convert a centerpage and check resultset:
(TODO: Use centerpage with dav properties!)

>>> cp = zeit.cms.interfaces.ICMSContent(
...     'http://xml.zeit.de/online/2007/01/index')
>>> cp_converter = zeit.solr.interfaces.ISolrConverter(cp)
>>> root_node = cp_converter.prepare_dav_props()
>>> print lxml.etree.tostring(root_node, pretty_print=True)
<add xmlns:py="http://codespeak.net/lxml/objectify/pytype" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <doc>
    <field ...
  </doc>
</add>
<BLANKLINE>



Clean up:

>>> zope.app.component.hooks.setSite(old_site)

